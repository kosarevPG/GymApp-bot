<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Gym Logger</title>
    
    <!-- Mobile Select CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mobile-select@1.0.28/dist/mobile-select.min.css">
    
    <!-- Telegram Web App SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 420px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 24px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        
        .header {
            text-align: center;
            margin-bottom: 24px;
        }
        
        .header h1 {
            font-size: 24px;
            font-weight: 700;
            color: #1a1a1a;
            margin-bottom: 8px;
        }
        
        .last-result {
            font-size: 14px;
            color: #666;
            margin-bottom: 20px;
            text-align: center;
            padding: 12px;
            background: #f5f5f5;
            border-radius: 12px;
        }
        
        .picker-group {
            margin-bottom: 24px;
        }
        
        .picker-label {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 12px;
            display: block;
        }
        
        .picker-input {
            width: 100%;
            padding: 16px;
            font-size: 18px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            background: #f9f9f9;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .picker-input:active {
            background: #f0f0f0;
            border-color: #667eea;
        }
        
        .buffer-info {
            background: #e3f2fd;
            border: 2px solid #2196f3;
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 14px;
            color: #1976d2;
            font-weight: 600;
        }
        
        .button-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .btn {
            padding: 16px 24px;
            font-size: 18px;
            font-weight: 600;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        
        .btn:active {
            transform: scale(0.98);
        }
        
        .btn-secondary {
            background: #f5f5f5;
            color: #333;
        }
        
        .btn-secondary:active {
            background: #e0e0e0;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-primary:active {
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 id="exerciseName">–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</h1>
            <div class="last-result" id="lastResult">–ü—Ä–æ—à–ª—ã–π —Ä–∞–∑: -</div>
        </div>
        
        <div id="bufferInfo" class="buffer-info hidden">
            –í –±—É—Ñ–µ—Ä–µ: <span id="bufferCount">0</span> —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ(–π)
        </div>
        
        <div class="picker-group">
            <label class="picker-label">–í–µ—Å (–∫–≥)</label>
            <input type="text" class="picker-input" id="weightPicker" readonly placeholder="–í—ã–±–µ—Ä–∏—Ç–µ –≤–µ—Å">
        </div>
        
        <div class="picker-group">
            <label class="picker-label">–ü–æ–≤—Ç–æ—Ä—ã</label>
            <input type="text" class="picker-input" id="repsPicker" readonly placeholder="–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–≤—Ç–æ—Ä—ã">
        </div>
        
        <div class="picker-group">
            <label class="picker-label">–û—Ç–¥—ã—Ö</label>
            <input type="text" class="picker-input" id="restPicker" readonly placeholder="–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ç–¥—ã—Ö">
        </div>
        
        <div class="button-group">
            <button class="btn btn-secondary" id="addToSetBtn">
                ‚ûï –î–æ–±–∞–≤–∏—Ç—å –≤ —Å–µ—Ç (+)
            </button>
            <button class="btn btn-primary" id="saveBtn">
                üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –∑–∞–∫—Ä—ã—Ç—å
            </button>
        </div>
    </div>
    
    <!-- Mobile Select JS -->
    <script src="https://cdn.jsdelivr.net/npm/mobile-select@1.0.28/dist/mobile-select.min.js"></script>
    
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();
        
        // –ü–∞—Ä—Å–∏–Ω–≥ URL –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
        const urlParams = new URLSearchParams(window.location.search);
        const exerciseName = decodeURIComponent(urlParams.get('ex') || '–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ');
        const lastWeight = parseFloat(urlParams.get('w') || '0');
        const lastReps = parseInt(urlParams.get('r') || '0');
        
        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞–∑–≤–∞–Ω–∏—è —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
        document.getElementById('exerciseName').textContent = exerciseName;
        
        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–æ—à–ª–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
        const lastResultEl = document.getElementById('lastResult');
        if (lastWeight > 0 || lastReps > 0) {
            lastResultEl.textContent = `–ü—Ä–æ—à–ª—ã–π —Ä–∞–∑: ${lastWeight}–∫–≥ √ó ${lastReps}`;
        } else {
            lastResultEl.textContent = '–ü–µ—Ä–≤–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞';
        }
        
        // –ë—É—Ñ–µ—Ä –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–¥—Ö–æ–¥–æ–≤
        let workoutBuffer = [];
        
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–Ω–∞—á–µ–Ω–∏–π –¥–ª—è –≤–µ—Å–∞ (—à–∞–≥ 1.25 –∏–ª–∏ 2.5, –¥–∏–∞–ø–∞–∑–æ–Ω 0-300)
        function generateWeightValues() {
            const values = [];
            for (let i = 0; i <= 300; i += 1.25) {
                // –û–∫—Ä—É–≥–ª—è–µ–º –¥–æ 2 –∑–Ω–∞–∫–æ–≤ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π
                const rounded = Math.round(i * 100) / 100;
                values.push(rounded.toFixed(2));
            }
            return values;
        }
        
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–Ω–∞—á–µ–Ω–∏–π –¥–ª—è –ø–æ–≤—Ç–æ—Ä–æ–≤ (1-100)
        function generateRepsValues() {
            return Array.from({length: 100}, (_, i) => i + 1);
        }
        
        // –ó–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –æ—Ç–¥—ã—Ö–∞ (–≤ —Å–µ–∫—É–Ω–¥–∞—Ö)
        const restValues = [
            {label: '0 —Å–µ–∫', value: 0},
            {label: '30 —Å–µ–∫', value: 30},
            {label: '60 —Å–µ–∫', value: 60},
            {label: '90 —Å–µ–∫', value: 90},
            {label: '2 –º–∏–Ω', value: 120},
            {label: '2.5 –º–∏–Ω', value: 150},
            {label: '3 –º–∏–Ω', value: 180},
            {label: '3.5 –º–∏–Ω', value: 210},
            {label: '4 –º–∏–Ω', value: 240},
            {label: '4.5 –º–∏–Ω', value: 270},
            {label: '5 –º–∏–Ω', value: 300}
        ];
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞—Ä–∞–±–∞–Ω–æ–≤ (pickers)
        let weightSelect, repsSelect, restSelect;
        
        // –ë–∞—Ä–∞–±–∞–Ω –¥–ª—è –≤–µ—Å–∞
        weightSelect = new MobileSelect({
            trigger: '#weightPicker',
            title: '–í—ã–±–µ—Ä–∏—Ç–µ –≤–µ—Å',
            wheels: [{
                data: generateWeightValues()
            }],
            initValue: lastWeight > 0 ? lastWeight.toFixed(2) : '0.00',
            callback: function(indexArr, data) {
                document.getElementById('weightPicker').value = data[0] + ' –∫–≥';
            }
        });
        
        // –ë–∞—Ä–∞–±–∞–Ω –¥–ª—è –ø–æ–≤—Ç–æ—Ä–æ–≤
        repsSelect = new MobileSelect({
            trigger: '#repsPicker',
            title: '–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–≤—Ç–æ—Ä—ã',
            wheels: [{
                data: generateRepsValues()
            }],
            initValue: lastReps > 0 ? lastReps : 1,
            callback: function(indexArr, data) {
                document.getElementById('repsPicker').value = data[0] + ' —Ä–∞–∑';
            }
        });
        
        // –ë–∞—Ä–∞–±–∞–Ω –¥–ª—è –æ—Ç–¥—ã—Ö–∞
        restSelect = new MobileSelect({
            trigger: '#restPicker',
            title: '–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ç–¥—ã—Ö',
            wheels: [{
                data: restValues.map(item => item.label)
            }],
            initValue: 0,
            callback: function(indexArr, data) {
                document.getElementById('restPicker').value = data[0];
            }
        });
        
        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞—á–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
        if (lastWeight > 0) {
            document.getElementById('weightPicker').value = lastWeight.toFixed(2) + ' –∫–≥';
        }
        if (lastReps > 0) {
            document.getElementById('repsPicker').value = lastReps + ' —Ä–∞–∑';
        }
        document.getElementById('restPicker').value = '60 —Å–µ–∫';
        
        // –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—É—â–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π
        function getCurrentValues() {
            const weightStr = weightSelect.getValue();
            const repsStr = repsSelect.getValue();
            const restStr = restSelect.getValue();
            
            const weight = parseFloat(weightStr) || 0;
            const reps = parseInt(repsStr) || 0;
            
            // –ù–∞—Ö–æ–¥–∏–º –∑–Ω–∞—á–µ–Ω–∏–µ –æ—Ç–¥—ã—Ö–∞ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
            const restItem = restValues.find(item => item.label === restStr);
            const rest = restItem ? restItem.value : 60;
            
            return { weight, reps, rest };
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –±—É—Ñ–µ—Ä–µ
        function updateBufferInfo() {
            const bufferInfoEl = document.getElementById('bufferInfo');
            const bufferCountEl = document.getElementById('bufferCount');
            
            if (workoutBuffer.length > 0) {
                bufferInfoEl.classList.remove('hidden');
                bufferCountEl.textContent = workoutBuffer.length;
            } else {
                bufferInfoEl.classList.add('hidden');
            }
        }
        
        // –ö–Ω–æ–ø–∫–∞ "–î–æ–±–∞–≤–∏—Ç—å –≤ —Å–µ—Ç"
        document.getElementById('addToSetBtn').addEventListener('click', function() {
            const current = getCurrentValues();
            
            workoutBuffer.push({
                exercise: exerciseName,
                weight: current.weight,
                reps: current.reps,
                rest: current.rest
            });
            
            updateBufferInfo();
            
            // –í–∏–∑—É–∞–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
            this.textContent = '‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ!';
            setTimeout(() => {
                this.textContent = '‚ûï –î–æ–±–∞–≤–∏—Ç—å –≤ —Å–µ—Ç (+)';
            }, 1000);
        });
        
        // –ö–Ω–æ–ø–∫–∞ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"
        document.getElementById('saveBtn').addEventListener('click', function() {
            // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—É—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ –±—É—Ñ–µ—Ä, –µ—Å–ª–∏ –æ–Ω–∏ –µ—â–µ –Ω–µ —Ç–∞–º
            const current = getCurrentValues();
            const currentExists = workoutBuffer.some(item => 
                item.exercise === exerciseName &&
                item.weight === current.weight &&
                item.reps === current.reps &&
                item.rest === current.rest
            );
            
            if (!currentExists) {
                workoutBuffer.push({
                    exercise: exerciseName,
                    weight: current.weight,
                    reps: current.reps,
                    rest: current.rest
                });
            }
            
            // –ï—Å–ª–∏ –±—É—Ñ–µ—Ä –ø—É—Å—Ç, –¥–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—É—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è
            if (workoutBuffer.length === 0) {
                workoutBuffer.push({
                    exercise: exerciseName,
                    weight: current.weight,
                    reps: current.reps,
                    rest: current.rest
                });
            }
            
            // –§–æ—Ä–º–∏—Ä—É–µ–º –∏—Ç–æ–≥–æ–≤—ã–π JSON
            const finalData = {
                type: "workout_data",
                payload: workoutBuffer
            };
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –±–æ—Ç
            tg.sendData(JSON.stringify(finalData));
            
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º WebApp
            tg.close();
        });
    </script>
</body>
</html>

